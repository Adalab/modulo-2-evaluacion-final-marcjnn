"use strict";let searchResults=[],favoriteShows=[];function search(){getSearchResults().then(parseResponse).then(createSearchList).then(renderSearchResults).then(addListnerToShowCard)}function getSearchResults(){const e=document.querySelector(".js-search-input");return fetch("//api.tvmaze.com/search/shows?q="+e.value)}function parseResponse(e){return e.json()}function createSearchList(e){if(searchResults=[],null!==e){const t=e;for(const e of t)searchResults.push(e.show)}updateImageProperty(),updateFavoriteProperty()}function updateImageProperty(){for(const e of searchResults)null!==e.image?e.image=e.image.medium:e.image="https://via.placeholder.com/210x295/D8BB8F/115B75/?text=TV"}function updateFavoriteProperty(){for(const e of searchResults)checkIfFavorite(e.id)?e.favorite=!0:e.favorite=!1}function updateSearchResults(){updateFavoriteProperty(),renderSearchResults(),addListnerToShowCard()}function renderSearchResults(){const e=document.querySelector(".js-search-results");for(;e.lastChild;)e.lastChild.remove();for(const t of searchResults){const a=createElement("li"),r=createElement("article"),o=createElement("img"),s=createElement("h2");o.setAttribute("src",t.image),o.setAttribute("alt",t.name),r.setAttribute("data-id",t.id),r.setAttribute("title","click to add to/remove from favorites"),s.classList.add("result__title"),o.classList.add("result__img"),r.classList.add("js-show-card"),t.favorite?r.classList.add("result__card--fav"):r.classList.add("result__card");const i=createTextNode(""+t.name);s.appendChild(i),r.appendChild(o),r.appendChild(s),a.appendChild(r),e.appendChild(a)}}function createElement(e){return document.createElement(e)}function createTextNode(e){return document.createTextNode(e)}function updateFavoriteList(e){checkIfFavorite(e.id)?removeFromFavorites(e):addToFavorites(e),updateFavoritesVisibility(),renderFavoriteShows(),addListnerToRemoveFromFavBtns(),saveToLocalStorage()}function getShow(e){for(const t of searchResults)if(t.id===e)return t}function checkIfFavorite(e){return!!favoriteShows.find(t=>t.id===e)}function addToFavorites(e){e.favorite=!0,favoriteShows.push(e)}function removeFromFavorites(e){const t=favoriteShows.findIndex(t=>t.name===e.name);e.favorite=!1,favoriteShows.splice(t,1)}function resetFavorites(){favoriteShows.splice(0,favoriteShows.length),updateFavoritesVisibility(),renderFavoriteShows(),saveToLocalStorage()}function updateFavoritesVisibility(){const e=document.querySelector(".js-favorites");0===favoriteShows.length?e.classList.add("favorites--hidden"):e.classList.remove("favorites--hidden")}function renderFavoriteShows(){const e=document.querySelector(".js-favorite-shows");for(;e.lastChild;)e.lastChild.remove();for(const t of favoriteShows){const a=createElement("li"),r=createElement("article"),o=createElement("img"),s=createElement("h3"),i=createElement("i");o.setAttribute("src",t.image),o.setAttribute("alt",t.name),i.setAttribute("data-id",t.id),i.setAttribute("title","remove from favorites"),r.setAttribute("data-id",t.id),o.classList.add("favoriteCard__img"),s.classList.add("favoriteCard__title"),i.classList.add("js-fav-rmv-btn"),i.classList.add("favoriteCard__btn--rmv"),i.classList.add("fas"),i.classList.add("fa-times"),r.classList.add("js-favorite-card"),r.classList.add("favoriteCard");const n=createTextNode(""+t.name);s.appendChild(n),r.appendChild(o),r.appendChild(s),r.appendChild(i),a.appendChild(r),e.appendChild(a)}}function saveToLocalStorage(){const e=JSON.stringify(favoriteShows);localStorage.setItem("favoriteShows",e)}function getFromLocalStorage(){const e=localStorage.getItem("favoriteShows");if(null!==e){const t=JSON.parse(e);favoriteShows=t}}function handleForm(e){e.preventDefault()}function handleSearchBtn(e){e.preventDefault(),search()}function handleFavorites(e){const t=e.currentTarget;updateFavoriteList(getShow(parseInt(t.getAttribute("data-id")))),updateSearchResults()}function handleRemoveFromFavBtn(e){const t=parseInt(e.currentTarget.getAttribute("data-id"));for(const e of favoriteShows)e.id===t&&updateFavoriteList(e);updateSearchResults()}function handleResetBtn(){resetFavorites(),updateSearchResults()}function addListnerToForm(){document.querySelector(".js-form").addEventListener("submit",handleForm)}function addListnerToSearchBtn(){document.querySelector(".js-search-btn").addEventListener("click",handleSearchBtn)}function addListnerToShowCard(){const e=document.querySelectorAll(".js-show-card");for(const t of e)t.addEventListener("click",handleFavorites)}function addListnerToRemoveFromFavBtns(){const e=document.querySelectorAll(".js-fav-rmv-btn");for(const t of e)t.addEventListener("click",handleRemoveFromFavBtn);document.querySelector(".js-fav-reset-btn").addEventListener("click",handleResetBtn)}function runApp(){addListnerToSearchBtn(),addListnerToForm(),getFromLocalStorage(),updateFavoritesVisibility(),renderFavoriteShows(),addListnerToRemoveFromFavBtns()}runApp();